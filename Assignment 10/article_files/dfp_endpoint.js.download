(function ($) {

    var site_uri = Drupal.settings.site_uri;

    //Append appropriate links with "/stdfp"
    $('a').each(function(){

        var link = this.href;
        var is_comp = link.indexOf("company-profiles/");
        var is_prod = link.indexOf("products/");
        var is_admin = link.indexOf("/admin/");
        var is_relevant_product = link.indexOf("?cmpid=relevantproduct");
        var is_us = link.indexOf(site_uri);

        if((is_comp > -1 || is_prod > -1) && is_admin === -1 && is_us !== -1 && is_relevant_product === -1)
        {
            $(this).attr("target","_blank");
            this.href = link+'/stdfp';
        }

    });


    $('a').click(function(){

        var link = this.href;
        link = link.replace('/stdfp','');
        var full_link = link;
        var is_comp = link.indexOf("company-profiles/");
        var is_prod = link.indexOf("products/");
        var is_admin = link.indexOf("/admin/");
        var is_us = link.indexOf(site_uri);

        link = link.replace('http://','');
        link = link.replace('https://','');
        link = link.substr(link.indexOf('/'));
        link = link.replace('/company-profiles/','');
        link = link.replace('/products/','');




        if(is_comp > -1 && is_admin === -1 && is_us !== -1)
        {
            //window.open('dfpcc/comp/'+link+'/tab', "_blank");
            $.ajax({
                type: 'GET',
                url: '/dfpcc/comp/'+link+'/ajax',
                cache: false
            }).done(function(data){
                //alert(data);
                if(data == 'true')
                {
                    window.open(full_link,"_self");
                }
            });
            //return false;
        }
        else if(is_prod > -1 && is_admin === -1 && is_us !== -1)
        {
            //window.open('dfpcc/prod/'+link+'/tab', "_blank");
            $.ajax({
                type: 'GET',
                url: '/dfpcc/prod/'+link+'/ajax',
                cache: false
            }).done(function(data){
                if(data == 'true')
                {
                    window.open(full_link,"_self");
                }
            });

        }

    });

})(jQuery);